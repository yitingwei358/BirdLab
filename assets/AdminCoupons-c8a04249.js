import{M as k,D as w}from"./DeleteModal-e2c44c9b.js";import{_ as L,H as D,r as p,o as c,c as u,d as e,b as l,w as x,n as f,u as V,N as E,e as $,F as M,j as S,t as b,f as P}from"./index-4d0c22ad.js";import{P as N}from"./PaginationEffect-2e0fd878.js";import{S as h}from"./sweetalert2-fb1ab54e.js";const U={props:{coupon:{type:Object,default(){return{}}},option:{type:String,default:""},isLoading:{type:Boolean,default:!1}},data(){return{modal:"",tempCoupon:{},due_date:"",errors:"",min_date:""}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()},todayDate(){const o=new Date,t=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),r=String(o.getDate()).padStart(2,"0");this.min_date=t+"-"+n+"-"+r},minDateRule(o){return o>=this.min_date?!0:"無法指定過去的日期"}},watch:{coupon(){if(this.tempCoupon=this.coupon,this.tempCoupon.due_date){const o=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");this.due_date=o[0]}else this.due_date=this.min_date,this.tempCoupon.due_date=this.min_date;this.option==="copy"&&(this.tempCoupon.title="【複製】"+this.tempCoupon.title)},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},components:{ErrorMessage:D},mounted(){this.modal=new k(this.$refs.couponModal),this.todayDate()}},T={class:"modal",tabindex:"-1",ref:"couponModal"},B={class:"modal-dialog"},R={class:"modal-content"},j={class:"modal-header"},A={class:"modal-title"},I={key:0},O={key:1},q=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},F={class:"mb-3"},H=e("label",{for:"title",class:"form-label"},"標題*",-1),Y={class:"mb-3"},G=e("label",{for:"coupon_code",class:"form-label"},"優惠碼*",-1),J={class:"mb-3"},K=e("label",{for:"due_date",class:"form-label"},"到期日*",-1),Q={class:"mb-3"},W=e("label",{for:"discount",class:"form-label"},"折扣百分比*",-1),X={class:"mb-3"},Z={class:"form-check"},ee=e("label",{class:"form-check-label",for:"is_enabled"}," 啟用 ",-1),te={class:"modal-footer"},oe=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),se={type:"submit",class:"btn btn-primary"},ne={key:0},ie={key:1};function le(o,t,n,r,s,a){const v=p("Loading-overlay"),m=p("v-field"),_=p("error-message"),y=p("v-form");return c(),u("div",T,[e("div",B,[e("div",R,[l(y,{ref:"form",class:"col",onSubmit:t[5]||(t[5]=()=>o.$emit("emit-update-coupon",s.tempCoupon))},{default:x(({errors:i})=>[e("div",j,[e("h5",A,[n.option==="build"||n.option==="copy"?(c(),u("span",I,"新增優惠卷")):(c(),u("span",O,"編輯優惠卷"))]),q]),e("div",z,[l(v,{active:n.isLoading,"z-index":1e3},null,8,["active"]),e("div",F,[H,l(m,{id:"title",name:"標題",type:"text",class:f(["form-control",{"is-invalid":i.標題}]),placeholder:"請輸入標題",rules:"required",modelValue:s.tempCoupon.title,"onUpdate:modelValue":t[0]||(t[0]=d=>s.tempCoupon.title=d)},null,8,["class","modelValue"]),l(_,{name:"標題",class:"invalid-feedback"})]),e("div",Y,[G,l(m,{id:"coupon_code",name:"優惠碼",type:"text",class:f(["form-control",{"is-invalid":i.優惠碼}]),placeholder:"請輸入優惠碼",rules:"required",modelValue:s.tempCoupon.code,"onUpdate:modelValue":t[1]||(t[1]=d=>s.tempCoupon.code=d)},null,8,["class","modelValue"]),l(_,{name:"優惠碼",class:"invalid-feedback"})]),e("div",J,[K,l(m,{id:"due_date",name:"到期日",type:"date",class:f(["form-control",{"is-invalid":i.到期日}]),placeholder:"請輸入到期日",rules:a.minDateRule,min:s.min_date,modelValue:s.due_date,"onUpdate:modelValue":t[2]||(t[2]=d=>s.due_date=d)},null,8,["class","rules","min","modelValue"]),l(_,{name:"到期日",class:"invalid-feedback"})]),e("div",Q,[W,l(m,{id:"discount",name:"折扣百分比",type:"number",class:f(["form-control",{"is-invalid":i.折扣百分比}]),placeholder:"請輸入折扣百分比",rules:"required|min_value:0|max_value:100",min:"0",max:"100",modelValue:s.tempCoupon.percent,"onUpdate:modelValue":t[3]||(t[3]=d=>s.tempCoupon.percent=d),modelModifiers:{number:!0}},null,8,["class","modelValue"]),l(_,{name:"折扣百分比",class:"invalid-feedback"})]),e("div",X,[e("div",Z,[V(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":t[4]||(t[4]=d=>s.tempCoupon.is_enabled=d)},null,512),[[E,s.tempCoupon.is_enabled]]),ee])])]),e("div",te,[oe,e("button",se,[n.option==="build"||n.option==="copy"?(c(),u("span",ne,"新增優惠券")):(c(),u("span",ie,"儲存變更"))])])]),_:1},512)])])],512)}const ae=L(U,[["render",le]]),{VITE_URL:g,VITE_PATH:C}={VITE_URL:"https://vue3-course-api.hexschool.io/",VITE_PATH:"j437437",BASE_URL:"/BirdLab/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},de={data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isNew:!0,isLoading:!1,pagination:{},currentPage:1,option:""}},methods:{getCouponList(o=1){this.isLoading=!0,this.currentPage=o;const t=`${g}v2/api/${C}/admin/coupons?page=${o}`;this.$http.get(t).then(n=>{this.isLoading=!1;const{coupons:r,pagination:s}=n.data;this.coupons=r,this.pagination=s}).catch(n=>{this.isLoading=!1,h.fire({icon:"error",title:n.response.data.message})})},openCouponModal(o,t){o==="build"?(this.tempCoupon={is_enabled:0},this.isNew=!0,this.option="build"):o==="edit"?(this.tempCoupon={...t},this.isNew=!1,this.option="edit"):(this.tempCoupon={...t},this.isNew=!0,this.option="copy"),this.$refs.couponModal.openModal()},updateCoupon(o){this.isLoading=!0;let t=`${g}v2/api/${C}/admin/coupon/${o.id}`,n="put";const r=o;this.isNew&&(t=`${g}v2/api/${C}/admin/coupon`,n="post"),this.$http[n](t,{data:r}).then(()=>{this.isLoading=!1,h.fire({icon:"success",title:"優惠券更新成功",confirmButtonColor:"#31523f"}),this.getCouponList(this.currentPage),this.$refs.couponModal.hideModal()}).catch(s=>{this.isLoading=!1,h.fire({icon:"error",title:s.response.data.message})})},openDeleteModal(o){this.tempCoupon={...o},this.$refs.deleteModal.openModal()},deleteCoupon(o){this.isLoading=!0;const t=`${g}v2/api/${C}/admin/coupon/${o.id}`;this.$http.delete(t).then(()=>{this.isLoading=!1,h.fire({icon:"success",title:"優惠券刪除成功",confirmButtonColor:"#31523f"}),this.$refs.deleteModal.hideModal(),this.getCouponList(this.currentPage)}).catch(n=>{this.isLoading=!1,h.fire({icon:"error",title:n.response.data.message})})},sortDates(o){o==="descending"?this.coupons.sort((t,n)=>n.due_date-t.due_date):o==="ascending"&&this.coupons.sort((t,n)=>t.due_date-n.due_date)}},components:{CouponModal:ae,DeleteModal:w,PaginationEffect:N},mounted(){this.getCouponList()}},ce={class:"container-fluid"},ue={class:"row mb-3"},pe={class:"d-flex justify-content-between align-items-center"},re=e("h3",{class:"mb-0"},"優惠券列表",-1),me={class:"text-end"},_e={class:"row"},he={class:"table-responsive table-scroll"},fe={class:"table my-4 text-nowrap"},be={class:"table-light"},ge=e("th",{scope:"col",width:"15%"},"名稱",-1),Ce=e("th",{scope:"col",width:"15%"},"代碼",-1),ve=e("th",{scope:"col",width:"10%"},"折扣",-1),ye={scope:"col",width:"20%"},Me=e("th",{scope:"col",width:"10%"},"狀態",-1),Le=e("th",{scope:"col",width:"30%",class:"text-end"},"編輯",-1),ke={key:0,class:"text-success"},we={key:1,class:"text-muted"},De={class:"d-flex justify-content-end"},xe=["onClick"],Ve=["onClick"],Ee=["onClick"];function $e(o,t,n,r,s,a){const v=p("Loading-overlay"),m=p("PaginationEffect"),_=p("CouponModal"),y=p("DeleteModal");return c(),u(M,null,[e("div",ce,[l(v,{active:s.isLoading,"z-index":1e3},null,8,["active"]),e("div",ue,[e("div",pe,[re,e("div",me,[e("button",{class:"btn btn-primary",type:"button",onClick:t[0]||(t[0]=()=>a.openCouponModal("build"))}," 建立新的優惠券 ")])])]),e("div",_e,[e("div",he,[e("table",fe,[e("thead",be,[e("tr",null,[ge,Ce,ve,e("th",ye,[$(" 到期日 "),e("i",{class:"bi bi-caret-down-fill ms-1",onClick:t[1]||(t[1]=()=>a.sortDates("descending")),style:{cursor:"pointer"}}),e("i",{class:"bi bi-caret-up-fill ms-1",onClick:t[2]||(t[2]=()=>a.sortDates("ascending")),style:{cursor:"pointer"}})]),Me,Le])]),(c(!0),u(M,null,S(s.coupons,(i,d)=>(c(),u("tbody",{key:d},[s.coupons.length?(c(),u("tr",{key:0,class:f({"text-secondary":!i.is_enabled})},[e("td",null,b(i.title),1),e("td",null,b(i.code),1),e("td",null,b(i.percent)+"%",1),e("td",null,b(o.$filters.date(i.due_date)),1),e("td",null,[i.is_enabled?(c(),u("span",ke,"啟用")):(c(),u("span",we,"未啟用"))]),e("td",null,[e("div",De,[e("button",{type:"button",onClick:()=>a.openCouponModal("copy",i),class:"btn btn-outline-wood btn-sm"}," 複製 ",8,xe),e("button",{type:"button",onClick:()=>a.openCouponModal("edit",i),class:"btn btn-outline-primary btn-sm me-3"}," 編輯 ",8,Ve),e("button",{type:"button",onClick:()=>a.openDeleteModal(i),class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,Ee)])])],2)):P("",!0)]))),128))])])])]),l(m,{pages:s.pagination,onEmitPages:a.getCouponList},null,8,["pages","onEmitPages"]),l(_,{ref:"couponModal",coupon:s.tempCoupon,option:s.option,"is-loading":s.isLoading,onEmitUpdateCoupon:a.updateCoupon},null,8,["coupon","option","is-loading","onEmitUpdateCoupon"]),l(y,{ref:"deleteModal",item:s.tempCoupon,"is-loading":s.isLoading,onEmitDelete:a.deleteCoupon},null,8,["item","is-loading","onEmitDelete"])],64)}const Te=L(de,[["render",$e]]);export{Te as default};
