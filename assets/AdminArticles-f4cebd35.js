import{M as D,D as U}from"./DeleteModal-e2c44c9b.js";import{C as N}from"./ckeditor-f9b0134a.js";import{_ as C,H as T,r as d,o as a,c as n,d as t,b as c,w as B,n as k,u as _,I as y,F as M,j as V,f as P,N as I,t as L}from"./index-4d0c22ad.js";import{P as S}from"./PaginationEffect-2e0fd878.js";import{S as u}from"./sweetalert2-fb1ab54e.js";const $={props:{article:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},data(){return{modal:"",tempArticle:{tag:[""]},create_at:0,editor:N,editorData:"<p>Content of the editor.</p>",editorConfig:{toolbar:{items:["link","undo","redo","|","heading","|","bold","italic","|","uploadImage","insertTable","mediaEmbed","|","bulletedList","numberedList","outdent","indent"]}}}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}},watch:{article(){this.tempArticle={...this.article,tag:this.article.tag||[],isPublic:this.article.isPublic||!1},[this.create_at]=new Date(this.tempArticle.create_at*1e3).toISOString().split("T")},create_at(){this.tempArticle.create_at=Math.floor(new Date(this.create_at)/1e3)}},components:{ErrorMessage:T},mounted(){this.modal=new D(this.$refs.articleModal)}},j={class:"modal fade","data-focus":"false",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"articleModal"},R={class:"modal-dialog modal-xl",role:"document"},O={class:"modal-content border-0"},z={class:"modal-header bg-dark text-white"},H={class:"modal-title",id:"exampleModalLabel"},q={key:0},F={key:1},G=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},K={class:"row"},Q={class:"col-sm-4"},W={class:"mb-3"},X=t("label",{for:"title",class:"form-label"},"標題*",-1),Y={class:"mb-3"},Z=t("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),tt={class:"mb-3"},et=t("label",{for:"author",class:"form-label"},"作者*",-1),st={class:"mb-3"},it=t("label",{for:"create_at"},"文章建立日期",-1),ot={class:"col-sm-8"},lt=t("label",{for:"tag",class:"form-label"},"標籤",-1),at={class:"row gx-1 mb-3"},nt={class:"input-group input-group-sm"},ct=["onUpdate:modelValue"],rt=["onClick"],dt=t("i",{class:"bi bi-x"},null,-1),mt=[dt],pt={key:0,class:"col-md-2 mb-1"},ut={class:"mb-3"},ht=t("label",{for:"description",class:"form-label"},"文章描述",-1),_t={class:"mb-3"},bt=t("label",{class:"form-label"},"文章內容*",-1),ft={class:"ck-body-wrapper"},gt={class:"mb-3"},At={class:"form-check"},vt=t("label",{class:"form-check-label",for:"isPublic"}," 是否公開 ",-1),yt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{type:"submit",class:"btn btn-primary"},"確認")],-1);function Lt(i,s,o,h,e,m){const w=d("Loading-overlay"),g=d("v-field"),A=d("error-message"),x=d("ckeditor"),r=d("v-form");return a(),n("div",j,[t("div",R,[t("div",O,[c(r,{ref:"form",class:"col",onSubmit:s[8]||(s[8]=()=>i.$emit("emit-update-article",e.tempArticle))},{default:B(({errors:v})=>[t("div",z,[t("h5",H,[o.isNew?(a(),n("span",q,"新增貼文")):(a(),n("span",F,"編輯貼文"))]),G]),t("div",J,[c(w,{active:o.isLoading,"z-index":1e3},null,8,["active"]),t("div",K,[t("div",Q,[t("div",W,[X,c(g,{id:"title",modelValue:e.tempArticle.title,"onUpdate:modelValue":s[0]||(s[0]=l=>e.tempArticle.title=l),name:"標題",type:"text",class:k(["form-control",{"is-invalid":v.標題}]),placeholder:"請輸入標題",rules:"required"},null,8,["modelValue","class"]),c(A,{name:"標題",class:"invalid-feedback"})]),t("div",Y,[Z,_(t("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":s[1]||(s[1]=l=>e.tempArticle.imageUrl=l),placeholder:"請輸入圖片連結"},null,512),[[y,e.tempArticle.imageUrl]])]),t("div",tt,[et,c(g,{id:"author",modelValue:e.tempArticle.author,"onUpdate:modelValue":s[2]||(s[2]=l=>e.tempArticle.author=l),name:"作者",type:"text",class:k(["form-control",{"is-invalid":v.作者}]),placeholder:"請輸入作者",rules:"required"},null,8,["modelValue","class"]),c(A,{name:"作者",class:"invalid-feedback"})]),t("div",st,[it,_(t("input",{type:"date",class:"form-control",id:"create_at","onUpdate:modelValue":s[3]||(s[3]=l=>e.create_at=l)},null,512),[[y,e.create_at]])])]),t("div",ot,[lt,t("div",at,[(a(!0),n(M,null,V(e.tempArticle.tag,(l,p)=>(a(),n("div",{class:"col-md-2 mb-1",key:p},[t("div",nt,[_(t("input",{type:"text",class:"form-control form-control",id:"tag","onUpdate:modelValue":E=>e.tempArticle.tag[p]=E,placeholder:"請輸入標籤"},null,8,ct),[[y,e.tempArticle.tag[p]]]),t("button",{type:"button",class:"btn btn-outline-danger",onClick:()=>e.tempArticle.tag.splice(p,1)},mt,8,rt)])]))),128)),e.tempArticle.tag[e.tempArticle.tag.length-1]||!e.tempArticle.tag.length?(a(),n("div",pt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:s[4]||(s[4]=()=>e.tempArticle.tag.push(""))}," 新增標籤 ")])):P("",!0)]),t("div",ut,[ht,_(t("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":s[5]||(s[5]=l=>e.tempArticle.description=l),placeholder:"請輸入文章描述"},null,512),[[y,e.tempArticle.description]])]),t("div",_t,[bt,t("div",ft,[c(x,{editor:e.editor,modelValue:e.tempArticle.content,"onUpdate:modelValue":s[6]||(s[6]=l=>e.tempArticle.content=l),config:e.editorConfig},null,8,["editor","modelValue","config"])])]),t("div",gt,[t("div",At,[_(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[7]||(s[7]=l=>e.tempArticle.isPublic=l),id:"isPublic"},null,512),[[I,e.tempArticle.isPublic]]),vt])])])])]),yt]),_:1},512)])])],512)}const Mt=C($,[["render",Lt]]),{VITE_URL:b,VITE_PATH:f}={VITE_URL:"https://vue3-course-api.hexschool.io/",VITE_PATH:"j437437",BASE_URL:"/BirdLab/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},wt={data(){return{articles:{},tempArticle:{},isNew:!1,isLoading:!1,pagination:{},currentPage:1}},methods:{getArticleList(i=1){this.isLoading=!0,this.currentPage=i;const s=`${b}v2/api/${f}/admin/articles`;this.$http.get(s).then(o=>{this.isLoading=!1;const{articles:h,pagination:e}=o.data;this.articles=h,this.pagination=e}).catch(o=>{this.isLoading=!1,u.fire({icon:"error",title:o.response.data.message})})},getArticleId(i){this.isLoading=!0;const s=`${b}v2/api/${f}/admin/article/${i.id}`;this.$http.get(s).then(o=>{this.isLoading=!1,this.openArticleModal(!1,o.data.article)}).catch(o=>{this.isLoading=!1,u.fire({icon:"error",title:o.response.data.message})})},openArticleModal(i,s){i?(this.tempArticle={create_at:new Date().getTime()/1e3,tag:[]},this.isNew=!0):(this.tempArticle={...s},this.isNew=!1),this.$refs.editArticleModal.openModal()},updateArticle(i){this.isLoading=!0;let s=`${b}v2/api/${f}/admin/article/${i.id}`,o="put";const h=i;this.isNew&&(s=`${b}v2/api/${f}/admin/article`,o="post"),this.$http[o](s,{data:h}).then(()=>{this.isLoading=!1,u.fire({icon:"success",title:"文章更新成功",confirmButtonColor:"#31523f"}),this.getArticleList(this.currentPage),this.$refs.editArticleModal.hideModal()}).catch(e=>{this.isLoading=!1,u.fire({icon:"error",title:e.response.data.message})})},openDeleteModal(i){this.tempArticle=i,this.$refs.deleteModal.openModal()},deleteArticle(i){this.isLoading=!0;const s=`${b}v2/api/${f}/admin/article/${i.id}`;this.$http.delete(s).then(()=>{this.isLoading=!1,u.fire({icon:"success",title:"文章刪除成功",confirmButtonColor:"#31523f"}),this.getArticleList(this.currentPage),this.$refs.deleteModal.hideModal()}).catch(o=>{this.isLoading=!1,u.fire({icon:"error",title:o.response.data.message})})}},components:{ArticleModal:Mt,DeleteModal:U,PaginationEffect:S},mounted(){this.getArticleList()}},xt={class:"container-fluid"},kt={class:"row mb-3"},Vt={class:"d-flex justify-content-between align-items-center"},Ct=t("h3",{class:"mb-0"},"文章列表",-1),Pt={class:"text-end"},Et={class:"row"},Dt={class:"table-responsive table-scroll"},Ut={class:"table my-4 text-nowrap"},Nt=t("thead",{class:"table-light"},[t("tr",null,[t("th",{scope:"col",width:"30%"},"標題"),t("th",{scope:"col",width:"10%"},"作者"),t("th",{scope:"col",width:"10%"},"標籤"),t("th",{scope:"col",width:"20%"},"建立日期"),t("th",{scope:"col",width:"10%"},"狀態"),t("th",{scope:"col",width:"20%",class:"text-end"},"編輯")])],-1),Tt={key:0,class:"text-success"},Bt={key:1,class:"text-muted"},It={class:"d-flex justify-content-end"},St=["onClick"],$t=["onClick"];function jt(i,s,o,h,e,m){const w=d("Loading-overlay"),g=d("PaginationEffect"),A=d("ArticleModal"),x=d("DeleteModal");return a(),n(M,null,[t("div",xt,[c(w,{active:e.isLoading,"z-index":1e3},null,8,["active"]),t("div",kt,[t("div",Vt,[Ct,t("div",Pt,[t("button",{class:"btn btn-primary",type:"button",onClick:s[0]||(s[0]=()=>m.openArticleModal(!0))}," 建立新文章 ")])])]),t("div",Et,[t("div",Dt,[t("table",Ut,[Nt,(a(!0),n(M,null,V(e.articles,(r,v)=>(a(),n("tbody",{key:v},[e.articles.length?(a(),n("tr",{key:0,class:k({"text-secondary":!r.isPublic})},[t("td",null,L(r.title),1),t("td",null,L(r.author),1),t("td",null,[(a(!0),n(M,null,V(r.tag,(l,p)=>(a(),n("span",{key:p,class:"badge rounded-pill text-bg-primary me-1"},L(l),1))),128))]),t("td",null,L(i.$filters.date(r.create_at)),1),t("td",null,[r.isPublic?(a(),n("span",Tt,"公開")):(a(),n("span",Bt,"未公開"))]),t("td",null,[t("div",It,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:()=>m.getArticleId(r)}," 編輯 ",8,St),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:()=>m.openDeleteModal(r)}," 刪除 ",8,$t)])])],2)):P("",!0)]))),128))]),c(g,{pages:e.pagination,onEmitPages:m.getArticleList},null,8,["pages","onEmitPages"])])])]),c(A,{ref:"editArticleModal",article:e.tempArticle,isNew:e.isNew,"is-loading":e.isLoading,onEmitUpdateArticle:m.updateArticle},null,8,["article","isNew","is-loading","onEmitUpdateArticle"]),c(x,{ref:"deleteModal",item:e.tempArticle,"is-loading":e.isLoading,onEmitDelete:m.deleteArticle},null,8,["item","is-loading","onEmitDelete"])],64)}const Ft=C(wt,[["render",jt]]);export{Ft as default};
