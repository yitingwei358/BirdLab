import{_ as E,H as I,r as p,o as i,c,b as n,w as $,d as e,n as _,u as m,I as k,m as T,a as L,f as b,J as y,F as S,j as U,e as V,t as g}from"./index-4d0c22ad.js";import{C as x}from"./CartStore-eb94c25b.js";import{S as C}from"./sweetalert2-fb1ab54e.js";const{VITE_URL:R,VITE_PATH:A}={VITE_URL:"https://vue3-course-api.hexschool.io/",VITE_PATH:"j437437",BASE_URL:"/BirdLab/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},w={data(){return{loadingItem:"",form:{user:{name:"",email:"",tel:"",address:""},message:""}}},components:{ErrorMessage:I},methods:{isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"請輸入正確的手機號碼"},createOrder(){const s=`${R}v2/api/${A}/order`,t=this.form;this.$http.post(s,{data:t}).then(a=>{C.fire({icon:"success",title:a.data.message,confirmButtonColor:"#31523f"}),this.$refs.form.resetForm(),t.message="",this.$emit("emit-refresh"),this.$router.push("/order")}).catch(a=>{C.fire({icon:"error",title:a.response.data.message})})}}},B={class:"my-5 justify-content-center"},O={class:"mb-3"},P=e("label",{for:"name",class:"form-label"},"收件人姓名*",-1),D={class:"mb-3"},j=e("label",{for:"email",class:"form-label"},"Email*",-1),F={class:"mb-3"},H=e("label",{for:"tel",class:"form-label"},"收件人電話*",-1),N={class:"mb-3"},q=e("label",{for:"address",class:"form-label"},"收件人地址*",-1),M={class:"mb-3"},z=e("label",{for:"message",class:"form-label"},"留言",-1),J=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function G(s,t,a,f,o,h){const d=p("v-field"),u=p("error-message"),v=p("v-form");return i(),c("div",B,[n(v,{ref:"form",onSubmit:h.createOrder},{default:$(({errors:l})=>[e("div",O,[P,n(d,{id:"name",name:"姓名",type:"text",class:_(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":t[0]||(t[0]=r=>o.form.user.name=r)},null,8,["class","modelValue"]),n(u,{name:"姓名",class:"invalid-feedback"})]),e("div",D,[j,n(d,{id:"email",name:"email",type:"email",class:_(["form-control",{"is-invalid":l.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":t[1]||(t[1]=r=>o.form.user.email=r)},null,8,["class","modelValue"]),n(u,{name:"email",class:"invalid-feedback"})]),e("div",F,[H,n(d,{id:"tel",name:"電話",type:"tel",class:_(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",rules:h.isPhone,modelValue:o.form.user.tel,"onUpdate:modelValue":t[2]||(t[2]=r=>o.form.user.tel=r)},null,8,["class","rules","modelValue"]),n(u,{name:"電話",class:"invalid-feedback"})]),e("div",N,[q,n(d,{id:"address",name:"地址",type:"text",class:_(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":t[3]||(t[3]=r=>o.form.user.address=r)},null,8,["class","modelValue"]),n(u,{name:"地址",class:"invalid-feedback"})]),e("div",M,[z,m(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[4]||(t[4]=r=>o.form.message=r)},null,512),[[k,o.form.message]])]),J]),_:1},8,["onSubmit"])])}const K=E(w,[["render",G]]),{VITE_URL:Q,VITE_PATH:W}={VITE_URL:"https://vue3-course-api.hexschool.io/",VITE_PATH:"j437437",BASE_URL:"/BirdLab/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},X={data(){return{products:[],productId:"",cart:{carts:{}},couponCode:"",checkingCoupon:!1,footerSticky:!1}},components:{OrderForm:K},methods:{...T(x,["getCarts","updateCartItem","deleteCartItem","deleteAllCart"]),getCoupon(s){this.checkingCoupon=!0;const t=`${Q}v2/api/${W}/coupon`,a={code:s};this.$http.post(t,{data:a}).then(f=>{C.fire({icon:"success",title:f.data.message,confirmButtonColor:"#31523f"}),this.checkingCoupon=!1,this.couponCode="",this.getCarts()}).catch(f=>{C.fire({icon:"error",title:f.response.data.message,text:"請輸入正確的優惠代碼"}),this.checkingCoupon=!1,this.couponCode=""})}},computed:{...L(x,["carts","total","final_total","isLoading"])},mounted(){this.getCarts()}},Y={class:"container py-5",style:{"min-height":"80vh"}},Z={class:"row justify-content-center"},ee={class:"col-lg-6 p-3"},te=e("h3",{class:"fs-2 text-center fw-bold mb-2"},"您的購物車清單",-1),se={key:0,class:"text-center"},oe=e("p",{class:"fs-4 text-forest fw-bold mt-5 mb-3"},"您還沒加入任何商品呦",-1),le={class:"d-flex justify-content-end mb-3"},ne={class:"bg-light p-2"},re={class:"table align-middle"},ae=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),ie=["onClick"],ce={key:0,class:"text-success"},de={class:"input-group input-group-sm"},ue={class:"input-group my-2"},me=["onUpdate:modelValue","onChange"],pe={class:"text-end"},fe={colspan:"4"},he={class:"input-group d-flex align-items-center"},_e=e("label",{for:"couponCode",class:"me-3"},"折扣碼",-1),be=["disabled"],ge={key:0,class:"fas fa-spinner fa-pulse"},Ce=e("td",{colspan:"3",class:"text-end"},"總計",-1),ve={class:"text-end"},ye=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Ve={class:"text-end text-success"};function ke(s,t,a,f,o,h){const d=p("Loading-overlay"),u=p("RouterLink"),v=p("OrderForm");return i(),c("div",Y,[n(d,{active:s.isLoading,"z-index":1e3},null,8,["active"]),e("div",Z,[e("div",ee,[te,this.carts.length===0?(i(),c("div",se,[oe,n(u,{to:"/products",type:"button",class:"btn btn-lg btn-primary"},{default:$(()=>[V("去逛逛 ")]),_:1})])):b("",!0),e("div",le,[m(e("button",{class:"btn btn-outline-danger p-2",type:"button",onClick:t[0]||(t[0]=(...l)=>s.deleteAllCart&&s.deleteAllCart(...l))}," 清空購物車 ",512),[[y,this.carts.length!==0]])]),m(e("div",ne,[e("table",re,[ae,e("tbody",null,[this.carts?(i(!0),c(S,{key:0},U(s.carts,l=>(i(),c("tr",{key:l.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:()=>s.deleteCartItem(l)}," x ",8,ie)]),e("td",null,[V(g(l.product.title)+" ",1),l.coupon?(i(),c("div",ce," 已套用優惠券 ")):b("",!0)]),e("td",null,[e("div",de,[e("div",ue,[m(e("input",{type:"number",class:"form-control",min:"1",max:"50","onUpdate:modelValue":r=>l.qty=r,onChange:()=>s.updateCartItem(l)},null,40,me),[[k,l.qty]])])])]),e("td",pe,g(s.$filters.currency(l.total)),1)]))),128)):b("",!0)]),e("tfoot",null,[e("tr",null,[e("td",fe,[e("div",he,[_e,m(e("input",{type:"text",class:"form-control",id:"couponCode","onUpdate:modelValue":t[1]||(t[1]=l=>o.couponCode=l),placeholder:"請輸入折扣代碼"},null,512),[[k,o.couponCode]]),e("button",{type:"submit",onClick:t[2]||(t[2]=()=>h.getCoupon(o.couponCode)),class:"btn btn-outline-primary",disabled:!o.couponCode||o.checkingCoupon},[o.checkingCoupon?(i(),c("i",ge)):b("",!0),V(" 使用 ")],8,be)])])]),e("tr",null,[Ce,e("td",ve,g(s.$filters.currency(this.total)),1)]),e("tr",null,[ye,e("td",Ve,g(s.$filters.currency(this.final_total)),1)])])])],512),[[y,this.carts.length!==0]]),m(n(v,{onEmitRefresh:t[3]||(t[3]=()=>s.getCarts())},null,512),[[y,this.carts.length!==0]])])])])}const Ie=E(X,[["render",ke]]);export{Ie as default};
