import{M as D,D as E}from"./DeleteModal-e2c44c9b.js";import{_ as L,r as m,o as d,c as r,d as e,b as f,u as p,I as g,t as l,f as k,N as w,F as y,j as C,n as P}from"./index-4d0c22ad.js";import{P as B}from"./PaginationEffect-2e0fd878.js";import{S as u}from"./sweetalert2-fb1ab54e.js";const V={props:{order:{type:Object,default(){return{}}},isLoading:{type:Boolean,default:!1}},data(){return{modal:"",tempOrder:{}}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}},watch:{order(){this.tempOrder=this.order}},mounted(){this.modal=new D(this.$refs.adOrderModalTest)}},T={class:"modal",tabindex:"-1",ref:"adOrderModalTest"},S={class:"modal-dialog modal-xl"},U={class:"modal-content"},N=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"訂單內容"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),A={class:"modal-body"},I={class:"row"},R={class:"col-lg-4"},j=e("h3",{class:"fw-bold"},"顧客資料",-1),z={class:"table"},q={key:0},F=e("th",null,"顧客姓名",-1),H=e("th",null,"Email",-1),G=e("th",null,"電話",-1),J=e("th",null,"地址",-1),K=e("th",null,"留言",-1),Q={key:0},W={key:1},X={class:"col-lg-8"},Y=e("h3",{class:"fw-bold"},"訂單細節",-1),Z={class:"table"},ee=e("th",null,"訂單編號",-1),te=e("th",null,"下單時間",-1),se=e("th",null,"付款時間",-1),oe={key:0},le={key:1},ne=e("th",null,"付款狀態",-1),de={class:"form-check form-switch"},re=["id"],ie=["for"],ae={key:0},ce={key:1},ue=e("th",null,"總金額",-1),he=e("h3",{class:"mt-5 fw-bold"},"選購商品",-1),pe={class:"table"},_e=e("thead",null,[e("tr",null,[e("th",null,"品名"),e("th",null,"產品編號"),e("th",{class:"text-end"},"原價"),e("th",{class:"text-end"},"售價"),e("th",{class:"text-end"},"數量"),e("th",{class:"text-end"},"金額")])],-1),me={class:"text-end"},fe={class:"text-end"},ge={class:"text-end"},be={class:"text-end"},Oe={class:"text-end"},ye={colspan:"6"},Me={class:"modal-footer"},ve=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ce(s,o,a,c,t,h){const M=m("Loading-overlay");return d(),r("div",T,[e("div",S,[e("div",U,[N,e("div",A,[f(M,{active:a.isLoading,"z-index":1e3},null,8,["active"]),e("div",I,[e("div",R,[j,e("table",z,[t.tempOrder.user?(d(),r("tbody",q,[e("tr",null,[F,e("td",null,[p(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=n=>t.tempOrder.user.name=n),class:"form-control","aria-label":"CustomerName"},null,512),[[g,t.tempOrder.user.name]])])]),e("tr",null,[H,e("td",null,[p(e("input",{type:"email","onUpdate:modelValue":o[1]||(o[1]=n=>t.tempOrder.user.email=n),class:"form-control","aria-label":"CustomerName"},null,512),[[g,t.tempOrder.user.email]])])]),e("tr",null,[G,e("td",null,[p(e("input",{type:"tel","onUpdate:modelValue":o[2]||(o[2]=n=>t.tempOrder.user.tel=n),class:"form-control","aria-label":"CustomerName"},null,512),[[g,t.tempOrder.user.tel]])])]),e("tr",null,[J,e("td",null,[p(e("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=n=>t.tempOrder.user.address=n),class:"form-control","aria-label":"CustomerName"},null,512),[[g,t.tempOrder.user.address]])])]),e("tr",null,[K,t.tempOrder.message?(d(),r("td",Q,l(t.tempOrder.message),1)):(d(),r("td",W,"( 無留言 )"))])])):k("",!0)])]),e("div",X,[Y,e("table",Z,[e("tbody",null,[e("tr",null,[ee,e("td",null,l(t.tempOrder.id),1)]),e("tr",null,[te,e("td",null,l(s.$filters.date(t.tempOrder.create_at)),1)]),e("tr",null,[se,e("td",null,[t.tempOrder.paid_date?(d(),r("span",oe,l(s.$filters.date(t.tempOrder.paid_date)),1)):(d(),r("span",le,"無法讀取付款時間"))])]),e("tr",null,[ne,e("td",null,[e("div",de,[p(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`paidSwitch2${t.tempOrder.id}`,"onUpdate:modelValue":o[4]||(o[4]=n=>t.tempOrder.is_paid=n)},null,8,re),[[w,t.tempOrder.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch2${t.tempOrder.id}`},[t.tempOrder.is_paid?(d(),r("span",ae,"已付款")):(d(),r("span",ce,"未付款"))],8,ie)])])]),e("tr",null,[ue,e("td",null,l(s.$filters.currency(t.tempOrder.total)),1)])])]),he,e("table",pe,[_e,(d(!0),r(y,null,C(t.tempOrder.products,(n,v)=>(d(),r("tbody",{key:v},[e("tr",null,[e("td",null,l(n.product.title),1),e("td",null,l(n.product.id),1),e("td",me,l(s.$filters.currency(n.product.origin_price)),1),e("td",fe,l(s.$filters.currency(n.product.price)),1),e("td",ge,l(n.qty),1),e("td",be,l(s.$filters.currency(n.total)),1)])]))),128)),e("tfoot",null,[e("tr",Oe,[e("td",ye," 總金額 NT$ "+l(s.$filters.currency(t.tempOrder.total)),1)])])])])])]),e("div",Me,[ve,e("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=()=>s.$emit("emit-changeOrderData",t.tempOrder))}," 儲存變更 ")])])])],512)}const Le=L(V,[["render",Ce]]),{VITE_URL:b,VITE_PATH:O}={VITE_URL:"https://vue3-course-api.hexschool.io/",VITE_PATH:"j437437",BASE_URL:"/BirdLab/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},ke={data(){return{orders:[],tempOrder:{},pagination:{},currentPage:1,isLoading:!1}},methods:{getOrderList(s=1){this.isLoading=!0,this.currentPage=s;const o=`${b}v2/api/${O}/admin/orders/?page=${s}`;this.$http.get(o).then(a=>{const{orders:c,pagination:t}=a.data;this.orders=c,this.pagination=t,this.isLoading=!1}).catch(a=>{this.isLoading=!1,u.fire({icon:"error",title:a.response.data.message})})},updatePaid(s){this.isLoading=!0;const o=`${b}v2/api/${O}/admin/order/${s.id}`,a={is_paid:s.is_paid,message:s.user.message,user:{address:s.user.address,email:s.user.email,name:s.user.name,tel:s.user.tel}};this.$http.put(o,{data:a}).then(()=>{this.getOrderList(this.currentPage),this.$refs.orderModalCom.hideModal(),this.isLoading=!1,u.fire({icon:"success",title:"付款狀態更新成功",confirmButtonColor:"#31523f"})}).catch(c=>{u.fire({icon:"error",title:c.response.data.message}),this.isLoading=!1})},openOrderModal(s){this.tempOrder={...s},this.$refs.orderModalCom.openModal()},changeOrderData(s){u.fire({title:"確定要儲存變更嗎?",text:"原始資料將被覆寫",showDenyButton:!1,showCancelButton:!0,confirmButtonText:"儲存",confirmButtonColor:"#31523f",cancelButtonText:"取消",reverseButtons:!0}).then(o=>{if(o.isConfirmed){this.isLoading=!0;const a=`${b}v2/api/${O}/admin/order/${s.id}`,c={is_paid:s.is_paid,user:{address:s.user.address,email:s.user.email,name:s.user.name,tel:s.user.tel}};this.$http.put(a,{data:c}).then(()=>{this.isLoading=!1,u.fire({icon:"success",title:"訂單更新成功",confirmButtonColor:"#31523f"}),this.getOrderList(this.currentPage),this.$refs.orderModalCom.hideModal()}).catch(t=>{this.isLoading=!1,u.fire({icon:"error",title:t.response.data.message})})}})},openDelOrderModal(s){this.tempOrder={...s},this.$refs.deleteModal.openModal()},deleteOrder(s){this.isLoading=!0;const o=`${b}v2/api/${O}/admin/order/${s.id}`;this.$http.delete(o).then(()=>{this.isLoading=!1,u.fire({icon:"success",title:"訂單刪除成功",confirmButtonColor:"#31523f"}),this.getOrderList(this.currentPage),this.$refs.deleteModal.hideModal()}).catch(a=>{this.isLoading=!1,u.fire({icon:"error",title:a.response.data.message})})}},components:{AdminOrderModal:Le,DeleteModal:E,PaginationEffect:B},mounted(){this.getOrderList()}},we={class:"container-fluid"},$e={class:"row mb-3"},xe=e("h3",{class:"mb-0"},"訂單頁面",-1),De={class:"row"},Ee={class:"table-responsive table-container table-scroll"},Pe={class:"table my-4 text-nowrap"},Be=e("thead",{class:"table-light"},[e("tr",null,[e("th",{scope:"col",width:"20%"},"訂單編號"),e("th",{scope:"col",width:"10%"},"姓名"),e("th",{scope:"col",width:"15%"},"購買時間"),e("th",{scope:"col",width:"20%"},"品項"),e("th",{scope:"col",width:"10%"},"總金額"),e("th",{scope:"col",width:"10%",class:"text-end"},"付款狀態"),e("th",{scope:"col",width:"10%",class:"text-end"},"編輯")])],-1),Ve={class:"list-unstyled"},Te={class:"text-end"},Se={class:"form-check form-switch"},Ue=["id","onUpdate:modelValue","onChange"],Ne=["for"],Ae={key:0},Ie={key:1},Re={class:"d-flex justify-content-end"},je=["onClick"],ze=["onClick"];function qe(s,o,a,c,t,h){const M=m("Loading-overlay"),n=m("PaginationEffect"),v=m("AdminOrderModal"),$=m("DeleteModal");return d(),r(y,null,[e("div",we,[e("div",$e,[e("div",null,[xe,f(M,{active:t.isLoading,"z-index":1e3},null,8,["active"])])]),e("div",De,[e("div",Ee,[e("table",Pe,[Be,(d(!0),r(y,null,C(t.orders,i=>(d(),r("tbody",{key:i.id},[t.orders.length?(d(),r("tr",{key:0,class:P({"text-secondary":!i.is_paid})},[e("td",null,l(i.id),1),e("td",null,l(i.user.name),1),e("td",null,l(s.$filters.date(i.create_at)),1),e("td",null,[e("ul",Ve,[(d(!0),r(y,null,C(i.products,(_,x)=>(d(),r("li",{key:x},l(_.product.title)+" * "+l(_.qty)+" "+l(_.product.unit),1))),128))])]),e("td",Te,l(s.$filters.currency(i.total)),1),e("td",null,[e("div",Se,[p(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`paidSwitch${i.id}`,"onUpdate:modelValue":_=>i.is_paid=_,onChange:()=>h.updatePaid(i)},null,40,Ue),[[w,i.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${i.id}`},[i.is_paid?(d(),r("span",Ae,"已付款")):(d(),r("span",Ie,"未付款"))],8,Ne)])]),e("td",null,[e("div",Re,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:()=>h.openOrderModal(i)}," 查看 ",8,je),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:()=>h.openDelOrderModal(i)}," 刪除 ",8,ze)])])],2)):k("",!0)]))),128))]),f(n,{pages:t.pagination,onEmitPages:h.getOrderList},null,8,["pages","onEmitPages"])])])]),f(v,{ref:"orderModalCom",order:t.tempOrder,"is-loading":t.isLoading,onEmitChangeOrderData:h.changeOrderData},null,8,["order","is-loading","onEmitChangeOrderData"]),f($,{ref:"deleteModal",item:t.tempOrder,"is-loading":t.isLoading,onEmitDelete:h.deleteOrder},null,8,["item","is-loading","onEmitDelete"])],64)}const Ke=L(ke,[["render",qe]]);export{Ke as default};
